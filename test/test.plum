-- Stdlib-ish

(define Id (lambda (x (Type0)) x))
(define Id1 (lambda (x (Type0 1)) x))
(define identity (lambda (t (Type0)) (lambda (x t) x)))
(define identity1 (lambda (t (Type0 1)) (lambda (x t) x)))

(inductive Void () ())
(inductive Unit () () (unit))
(inductive Bool () () (true) (false))

-- Non-dependent function type
(define Fun (lambda (I (Type0)) (lambda (O (Type0)) (Pi (x I) O))))
(define Not (lambda (P (Type0)) (Fun P Void)))

(inductive Maybe ((T (Type0))) () (nothing) (just ((v T)) ()))
(inductive IsJust ((T (Type0))) ((mv (Maybe T))) (proveJust ((v T)) ((just T v))))

(inductive Either ((L (Type0)) (R (Type0))) ()
  (left ((v L))) (right ((v R))))

(inductive Decide ((P (Type0))) ()
  (proven ((proof P))) (disproven ((disproof (Not P)))))

(inductive Eq ((T (Type0))) ((x T) (z T))
  (refl ((y T)) ((y) (y))))

(define not
  (lambda (b Bool)
    (caseOn (lambda (b Bool) Bool) b
      (record (true false) (false true)))))

(define not_not
  (lambda (b Bool)
    (caseOn (lambda (b Bool) (Eq Bool (not (not b)) b)) b
      (record (true (refl Bool true)) (false (refl Bool false))))))

(define isJust
  (lambda (T (Type0))
    (lambda (m (Maybe T))
      (caseOn (lambda (m (Maybe T)) Bool) m
        (record
          (nothing false)
          (just (lambda (v T) true)))))))

-- Tests

(namedTest "defEq1"
  (defEq (Fun Unit Void) (Pi (t Unit) Void)))

(namedTest "defEq2"
  (defEq (identity Unit unit) unit))

(namedTest "not"
  (namedTest "typechecks"
    (hasType (Pi (b Bool) Bool) (not)))
  (namedTest "reduces"
    (defEq (not true) (false))
    (defEq (not false) (true))))

(namedTest "not_not"
  (namedTest "typechecks"
    (hasType (Pi (b Bool) (Eq Bool (not (not b)) b)) (not_not)))
  (namedTest "reduces"
    (defEq (not_not true) (refl Bool true))
    (defEq (not_not false) (refl Bool false))))

(namedTest "isJust"
  (namedTest "typechecks"
    (hasType (Pi (T (Type0)) (Pi (m (Maybe T)) Bool)) (isJust)))
  (namedTest "specializes"
    (hasType (Pi (m (Maybe Unit)) Bool) (isJust Unit)))
  (namedTest "reduces"
    (defEq (isJust Unit (nothing Unit)) (false))
    (defEq (isJust Unit (just Unit unit)) (true))

    (defEq (lambda (T (Type0)) (isJust T (nothing T))) (lambda (T (Type0)) false))
    (defEq (lambda (T (Type0)) (lambda (t T) (isJust T (just T t)))) (lambda (T (Type0)) (lambda (t T) true)))))

